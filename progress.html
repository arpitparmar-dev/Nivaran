<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NIVARAN Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<style>
:root{
  --primary:#2A1503;
  --secondary:#66350F;
  --bg:#F5F5DC;
  --card:#C2B280;
  --accent:#E8D8C4;
  --shield:#1cb0f6;
}

*{box-sizing:border-box; font-family:"Segoe UI",sans-serif; transition: 0.3s;}
body{ margin:0; background:var(--bg); color:var(--primary); overflow-x:hidden; }

/* üå∏ MANDALA ANIMATIONS */
.flower-bg{ position:fixed; inset:0; z-index:-1; pointer-events:none; }

.mandala{
    position:absolute;
    width:950px;
    height:950px;
    opacity:0.25;
    animation: flowerSpin 220s linear infinite;
}

.mandala.left{ top:-250px; left:-250px; }
.mandala.right{ bottom:-250px; right:-250px; animation-duration:260s; }

@keyframes flowerSpin{
    from{ transform:rotate(0deg); }
    to{ transform:rotate(360deg); }
}

/* SIDEBAR & PROGRESS */
#menuIcon{ position:fixed; top:20px; left:20px; font-size:26px; cursor:pointer; z-index:2001; }
#sidebarOverlay { position: fixed; inset: 0; background: rgba(0,0,0,0.3); display: none; z-index: 1999; backdrop-filter: blur(2px); }
#sidebar { 
    position: fixed; top: 0; left: -320px; width: 300px; height: 100vh; 
    background: var(--card); padding: 40px 20px; transition: 0.4s; 
    z-index: 2000; border-right: 2px solid var(--secondary); overflow-y: auto;
    display: flex; flex-direction: column;
}
#sidebar.open { left: 0; }

.profile-container { position: relative; width: 90px; height: 90px; margin: 0 auto 15px; }
.profile-img { width: 100%; height: 100%; background: var(--accent); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 40px; border: 3px solid var(--secondary); overflow: hidden; position: relative; z-index: 2; }
.profile-effect { position: absolute; top: -5px; left: -5px; width: 100px; height: 100px; border-radius: 50%; z-index: 1; box-shadow: 0 0 25px 12px rgba(255, 152, 0, 0.6); animation: pulseFire 1.2s infinite; }
@keyframes pulseFire { 0%, 100% { transform: scale(1); opacity: 0.6; } 50% { transform: scale(1.1); opacity: 0.9; } }

.mini-progress-bg { width: 100%; height: 8px; background: var(--accent); border-radius: 10px; margin-top: 5px; overflow: hidden; }
.mini-progress-fill { height: 100%; background: var(--secondary); width: 0%; transition: width 0.8s; }
.recovery-label { font-size: 10px; font-weight: bold; display: flex; justify-content: space-between; margin-top: 15px; text-transform: uppercase; }

/* CIRCULAR WIDGETS */
.stats-row { display: flex; justify-content: center; gap: 20px; margin-bottom: 25px; }
.stat-circle {
    width: 85px; height: 85px; border-radius: 50%;
    background: var(--accent); border: 3px solid var(--secondary);
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}
.stat-value { font-size: 24px; font-weight: bold; color: var(--primary); }
.stat-label { font-size: 10px; text-transform: uppercase; opacity: 0.7; }

/* CARDS & BUTTONS */
.container{ max-width:800px; margin:auto; padding:80px 20px 20px; }
.card{ background:var(--card); padding:16px; border-radius:18px; margin-bottom:15px; box-shadow: 0 4px 10px rgba(0,0,0,0.08); }
.addiction-btn{ cursor:pointer; border-left:6px solid var(--secondary); transition: 0.2s; }
.addiction-btn:hover { transform: translateX(8px); background: var(--accent); }

.task-row{ display:flex; justify-content:space-between; align-items:center; padding:12px; border-radius:10px; margin-bottom:8px; background:rgba(255,255,255,0.3); }
.special-mission { border: 2px solid var(--secondary); background: var(--accent); padding: 15px; margin-bottom: 20px; border-radius: 15px;}

.update-btn{ width:100%; padding:16px; font-size:18px; border-radius:12px; background: var(--primary); color: white; border: none; font-weight: bold; cursor: pointer; }
.nav-btn { background: var(--accent); color: var(--primary); padding: 8px 15px; border-radius: 8px; border: 1px solid var(--secondary); font-weight: bold; cursor: pointer; }

/* MODALS */
.modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.85); z-index: 4000; display: none; align-items: center; justify-content: center; }
.modal-card { background: var(--bg); padding: 25px; border-radius: 20px; text-align: center; width: 320px; border: 2px solid var(--secondary); }

/* TROPHY */
.trophy-zone { text-align: center; margin-bottom: 20px; }
#trophyPath { stroke-dasharray: 260; stroke-dashoffset: 260; transition: stroke-dashoffset 1.5s ease; }
.shield-badge { background: var(--shield); color: white; padding: 6px 15px; border-radius: 20px; font-weight: bold; display: inline-flex; align-items: center; gap: 8px; }
</style>
</head>

<body onload="initApp()">

<div class="flower-bg">

<!-- LEFT FLOWER MANDALA -->
<svg class="mandala left" viewBox="0 0 800 800">
  <defs>
    <path id="petal"
      d="M0,-220
         C80,-170 80,-70 0,-40
         C-80,-70 -80,-170 0,-220"/>
  </defs>

  <g transform="translate(400 400)" fill="none" stroke="#C2A878" stroke-width="2">
    <circle r="280"/>
    <circle r="240"/>

    <use href="#petal"/>
    <use href="#petal" transform="rotate(20)"/>
    <use href="#petal" transform="rotate(40)"/>
    <use href="#petal" transform="rotate(60)"/>
    <use href="#petal" transform="rotate(80)"/>
    <use href="#petal" transform="rotate(100)"/>
    <use href="#petal" transform="rotate(120)"/>
    <use href="#petal" transform="rotate(140)"/>
    <use href="#petal" transform="rotate(160)"/>
    <use href="#petal" transform="rotate(180)"/>
    <use href="#petal" transform="rotate(200)"/>
    <use href="#petal" transform="rotate(220)"/>
    <use href="#petal" transform="rotate(240)"/>
    <use href="#petal" transform="rotate(260)"/>
    <use href="#petal" transform="rotate(280)"/>
    <use href="#petal" transform="rotate(300)"/>
    <use href="#petal" transform="rotate(320)"/>
    <use href="#petal" transform="rotate(340)"/>

    <circle r="120"/>
  </g>
</svg>

<!-- RIGHT FLOWER MANDALA -->
<svg class="mandala right" viewBox="0 0 800 800">
  <g transform="translate(400 400)" fill="none" stroke="#C2A878" stroke-width="2">
    <circle r="280"/>
    <circle r="240"/>

    <use href="#petal"/>
    <use href="#petal" transform="rotate(20)"/>
    <use href="#petal" transform="rotate(40)"/>
    <use href="#petal" transform="rotate(60)"/>
    <use href="#petal" transform="rotate(80)"/>
    <use href="#petal" transform="rotate(100)"/>
    <use href="#petal" transform="rotate(120)"/>
    <use href="#petal" transform="rotate(140)"/>
    <use href="#petal" transform="rotate(160)"/>
    <use href="#petal" transform="rotate(180)"/>
    <use href="#petal" transform="rotate(200)"/>
    <use href="#petal" transform="rotate(220)"/>
    <use href="#petal" transform="rotate(240)"/>
    <use href="#petal" transform="rotate(260)"/>
    <use href="#petal" transform="rotate(280)"/>
    <use href="#petal" transform="rotate(300)"/>
    <use href="#petal" transform="rotate(320)"/>
    <use href="#petal" transform="rotate(340)"/>

    <circle r="120"/>
  </g>
</svg>

</div>

<div id="menuIcon" onclick="toggleSidebar()">‚ò∞</div>
<div id="sidebarOverlay" onclick="toggleSidebar()"></div>

<div id="sidebar">
  <div id="profileDisplay" style="text-align:center;">
    <button onclick="showEditProfile()" style="float:right; background:none; border:none; cursor:pointer;">‚úèÔ∏è</button>
    <div class="profile-container"><div class="profile-effect"></div><div id="userAvatar" class="profile-img">üë§</div></div>
    <h3 id="currentUserName">Guest</h3>
  </div>

  <div id="profileEdit" style="display:none;" class="card">
    <input type="text" id="userNameInput" placeholder="Name" style="width:100%; padding:8px; margin-bottom:10px;">
    <button class="nav-btn" onclick="document.getElementById('imgInput').click()" style="width:100%; margin-bottom:10px;">Upload Photo</button>
    <input type="file" id="imgInput" style="display:none" onchange="previewImg(this)">
    <button class="update-btn" style="font-size:12px; padding:8px;" onclick="saveProfile()">Save</button>
  </div>

  <div id="sidebarStats">
      <div class="recovery-label"><span>Mobile</span><span id="pct-sm">0%</span></div>
      <div class="mini-progress-bg"><div id="bar-sm" class="mini-progress-fill"></div></div>
      <div class="recovery-label"><span>Smoking</span><span id="pct-sa">0%</span></div>
      <div class="mini-progress-bg"><div id="bar-sa" class="mini-progress-fill"></div></div>
      <div class="recovery-label"><span>Gaming</span><span id="pct-gm">0%</span></div>
      <div class="mini-progress-bg"><div id="bar-gm" class="mini-progress-fill"></div></div>
      <div class="recovery-label"><span>Food</span><span id="pct-jf">0%</span></div>
      <div class="mini-progress-bg"><div id="bar-jf" class="mini-progress-fill"></div></div>
  </div>

  <button class="update-btn" style="margin-top:auto; background:#962d2d; font-size:11px;" onclick="showResetModal()">‚ö†Ô∏è RESET ALL</button>
  <button 
  class="update-btn" 
  style="
    margin-top:10px;
    background:#962d2d;
    font-size:10px;
    padding:8px;
    height:5%;
  "
  onclick="window.location.href='auth.html'">
  üö™ SIGN OUT
</button>
</div>

<div class="container" id="dashboard">
  <h2>Select Addiction</h2>
  <div class="card addiction-btn" onclick="openAddiction('Mobile & Social Media')">üì± Mobile & Social Media</div>
  <div class="card addiction-btn" onclick="openAddiction('Smoking / Alcohol')">üö¨ Smoking / Alcohol</div>
  <div class="card addiction-btn" onclick="openAddiction('Gaming')">üéÆ Gaming</div>
  <div class="card addiction-btn" onclick="openAddiction('Junk Food')">üçî Junk Food</div>
</div>

<div class="container" id="addictionPage" style="display:none">
  <button class="nav-btn" onclick="goBack()" style="margin-bottom:20px;">‚Üê Dashboard</button>
  
  <div class="stats-row">
      <div class="stat-circle"><span class="stat-value" id="widgetDay">1</span><span class="stat-label">Day</span></div>
      <div class="stat-circle" style="border-color: #e67e22;"><span class="stat-value" id="widgetStreak">0</span><span class="stat-label">Streak</span></div>
  </div>

  <div class="trophy-zone">
    <div class="shield-badge">üõ°Ô∏è <span id="shieldCount">0</span> Shields</div>
    <br><br>
    <svg width="120" height="120" viewBox="0 0 100 100">
        <defs>
            <linearGradient id="bronze" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#cd7f32"/><stop offset="100%" style="stop-color:#8b4513"/></linearGradient>
            <linearGradient id="silver" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#c0c0c0"/><stop offset="100%" style="stop-color:#707070"/></linearGradient>
            <linearGradient id="gold" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#ffd700"/><stop offset="100%" style="stop-color:#b8860b"/></linearGradient>
        </defs>
        <path d="M30,25 Q15,25 15,40 T30,50 M70,25 Q85,25 85,40 T70,50 M40,80 h20 M50,80 v10 M35,90 h30" fill="none" stroke="#d1ccbc" stroke-width="3"/>
        <path id="trophyPath" d="M30,20 h40 v30 c0,20 -10,30 -20,30 s-20,-10 -20,-30 z" fill="none" stroke="#d1ccbc" stroke-width="5"/>
    </svg>
    <h3 id="milestoneLabel">Goal: Day 7</h3>
  </div>

  <div id="taskContent">
    <div id="specialTaskBox"></div>
    <h3 id="routineHeading">Today's Routine</h3>
    <div class="card" id="taskList"></div>
    <button class="update-btn" onclick="markDone()">COMPLETE DAY</button>
  </div>

  <div id="successCard" class="card" style="display:none; text-align:center; background:var(--secondary); color:white;">
      <h2 id="successTitle">üåü</h2>
      <button class="update-btn" style="background:white; color:var(--secondary)" onclick="advanceToNextDay()">Start Next Day</button>
  </div>
</div>

<div id="warningModal" class="modal-overlay">
    <div class="modal-card">
        <h2 style="font-size: 50px; margin: 0;">‚ö†Ô∏è</h2>
        <h3>Tasks Incomplete</h3>
        <p>Please finish all your routine tasks before completing the day!</p>
        <button class="update-btn" onclick="hideWarning()">OK, I'LL DO IT</button>
    </div>
</div>

<div id="resetModal" class="modal-overlay">
    <div class="modal-card">
        <h3>Reset Everything?</h3>
        <button class="update-btn" style="background:#962d2d; margin-bottom:10px;" onclick="confirmReset()">YES, RESET</button>
        <button class="nav-btn" style="width:100%" onclick="hideResetModal()">CANCEL</button>
    </div>
</div>

<script src="app.js"></script>
</body>
</html>
